<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DashBoard | Anonymous messages</title>
    <link rel="stylesheet" href="./css/general.css">
</head>
<body>
    <!-- Welcome to Anon-msg [time] -->
    <require src="./components/navbar.html">
    <main>
        <div class="center">
            <div class="label">Anon-Message</div>
            <p>[name]'s messages</p>
            <div class="messages">
                <span class="noMsg">No Anonymous Message yet</span>
            </div>
        </div>
    </main>
    <aside class="share">
        <div class="copy" id="link">
            [id]
        </div>
        <button class="execCopy">Copy</button>
        <button id="whatsapp">Share on Whatsapp</button>
        <button id="otherShare">More to Share</button>
    </aside>

    <require src="./components/footer.html" hidden="">
    <script>
        window.addEventListener("DOMContentLoaded", runApp);

        function runApp() {
            const link = document.getElementById("link");
            link.innerText = location.protocol + "//" + location.hostname + ":" + location.port + "/postmsg?id=" + link.innerText.trim() + "&name=" + "[name]";

            loadMsg();
        }

        function loadMsg() {
            const viewMsg = document.querySelector(".messages");
            fetch("/getmsgs", {
                method: "POST",
                body: JSON.stringify({userId: "[name]=[id]"}),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(res => res.json())
            .then(data => {
                data.data.forEach(i => {
                    viewMsg.innerHTML += `<div class="msg-container">
                            <p class="msg-body">${i.text}</p>
                            <span class="msg-date">${i.createdAt}</span>
                            <button class="msg-button">Delete</button>
                        </div>
                        `;
                })
            })
            .catch(err => {
                console.log(err);
                alert("Sorry an error occurred while fetching messages");
            })
        }
    </script>
</body>
</html>